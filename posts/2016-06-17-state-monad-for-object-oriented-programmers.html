<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Victor Moroz - State monad for object-oriented programmers</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-62008520-1', 'auto');
            ga('send', 'pageview');
        </script>
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">Victor Moroz</a>
            </div>
            <div id="navigation">
                |
                <a href="../">Index</a>
<!--             
                <a href="/about.html">About</a>
                <a href="/contact.html">Contact</a>
                <a href="/archive.html">Archive</a>
-->        
            </div>
            <div class="spacer">
            </div>
        </div>

        <div id="content">
            <h3>State monad for object-oriented programmers</h3>
            <div class="info">
    Posted on June 17, 2016
    
</div>

<p>Let’s start from building a simple stack-based calculator using object-oriented approach. The calculator is represented by a stack of integers (<code>List[Int]</code>) and certain operations which modify the stack and can return a result.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">class</span> <span class="fu">Calc</span>(<span class="kw">var</span> stack: List[Int]) {</a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="kw">def</span> <span class="fu">push</span>(x: Int): Unit = {</a>
<a class="sourceLine" id="cb1-3" title="3">    stack = x::stack</a>
<a class="sourceLine" id="cb1-4" title="4">  }</a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6">  <span class="kw">def</span> <span class="fu">pop</span>(): Int = {</a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="kw">val</span> x::tail = stack</a>
<a class="sourceLine" id="cb1-8" title="8">    stack = tail</a>
<a class="sourceLine" id="cb1-9" title="9">    x</a>
<a class="sourceLine" id="cb1-10" title="10">  }</a>
<a class="sourceLine" id="cb1-11" title="11"></a>
<a class="sourceLine" id="cb1-12" title="12">  <span class="co">// s0 + s1</span></a>
<a class="sourceLine" id="cb1-13" title="13">  <span class="kw">def</span> <span class="fu">add</span>(): Int = {</a>
<a class="sourceLine" id="cb1-14" title="14">    <span class="kw">val</span> a = <span class="fu">pop</span>()</a>
<a class="sourceLine" id="cb1-15" title="15">    <span class="kw">val</span> b = <span class="fu">pop</span>()</a>
<a class="sourceLine" id="cb1-16" title="16">    a + b</a>
<a class="sourceLine" id="cb1-17" title="17">  }</a>
<a class="sourceLine" id="cb1-18" title="18"></a>
<a class="sourceLine" id="cb1-19" title="19">  <span class="co">// s0 * s1</span></a>
<a class="sourceLine" id="cb1-20" title="20">  <span class="kw">def</span> <span class="fu">mul</span>(): Int = {</a>
<a class="sourceLine" id="cb1-21" title="21">    <span class="kw">val</span> a = <span class="fu">pop</span>()</a>
<a class="sourceLine" id="cb1-22" title="22">    <span class="kw">val</span> b = <span class="fu">pop</span>()</a>
<a class="sourceLine" id="cb1-23" title="23">    a * b</a>
<a class="sourceLine" id="cb1-24" title="24">  }</a>
<a class="sourceLine" id="cb1-25" title="25">}</a>
<a class="sourceLine" id="cb1-26" title="26"></a>
<a class="sourceLine" id="cb1-27" title="27"><span class="kw">val</span> c = <span class="kw">new</span> <span class="fu">Calc</span>(List[Int]())</a>
<a class="sourceLine" id="cb1-28" title="28">c.<span class="fu">push</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1-29" title="29">c.<span class="fu">push</span>(<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb1-30" title="30">c.<span class="fu">add</span>() <span class="co">//&gt; 5</span></a></code></pre></div>
<p>Looks good so far, now I want to add a slightly more complex logic, I want to compute <code>(a * b + c * d)</code>, where <code>a, b, c, d</code> are the top 4 values in my stack. I have two options, one is to add the method to <code>Calc</code> class like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb2-1" title="1">  <span class="co">// s0 * s1 + s2 * s3</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="kw">def</span> <span class="fu">m1</span>(): Int = {</a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="kw">val</span> ab = <span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="kw">val</span> cd = <span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="fu">push</span>(ab)</a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="fu">push</span>(cd)</a>
<a class="sourceLine" id="cb2-7" title="7">    <span class="fu">add</span>()</a>
<a class="sourceLine" id="cb2-8" title="8">  }</a></code></pre></div>
<p>but I don’t want to pollute my clean and nice <code>Calc</code> class as this method can be specific to some part of my program, instead I want to create some temporary method (preferrably a function), so I can pass it around and combine with other functions:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">object</span> Calc {</a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="kw">import</span> Calc._</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="co">// s0 * s1 + s2 * s3</span></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="kw">val</span> m1: Calc =&gt; Int = </a>
<a class="sourceLine" id="cb3-6" title="6">    calc =&gt; {</a>
<a class="sourceLine" id="cb3-7" title="7">      <span class="kw">val</span> ab = calc.<span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb3-8" title="8">      <span class="kw">val</span> cd = calc.<span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb3-9" title="9">      calc.<span class="fu">push</span>(ab)</a>
<a class="sourceLine" id="cb3-10" title="10">      calc.<span class="fu">push</span>(cd)</a>
<a class="sourceLine" id="cb3-11" title="11">      calc.<span class="fu">add</span>()</a>
<a class="sourceLine" id="cb3-12" title="12">    }</a></code></pre></div>
<p>Later I decided that I would need <code>(a * b + c * d) * e</code> too, and since I want to reuse my work I simply added more methods like the above. I also added <code>m0</code> to push 4 values to the stack in one shot:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">object</span> Calc {</a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="kw">import</span> Calc._</a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="co">// (a, b, c, d) =&gt; (s0, s1, s2, s3)</span></a>
<a class="sourceLine" id="cb4-5" title="5">  <span class="kw">val</span> m0: (Calc, Int, Int, Int, Int) =&gt; Int =</a>
<a class="sourceLine" id="cb4-6" title="6">    (calc, a, b, c, d) =&gt; {</a>
<a class="sourceLine" id="cb4-7" title="7">      calc.<span class="fu">push</span>(d)</a>
<a class="sourceLine" id="cb4-8" title="8">      calc.<span class="fu">push</span>(c)</a>
<a class="sourceLine" id="cb4-9" title="9">      calc.<span class="fu">push</span>(b)</a>
<a class="sourceLine" id="cb4-10" title="10">      calc.<span class="fu">push</span>(a)</a>
<a class="sourceLine" id="cb4-11" title="11">      <span class="dv">0</span></a>
<a class="sourceLine" id="cb4-12" title="12">    }</a>
<a class="sourceLine" id="cb4-13" title="13"></a>
<a class="sourceLine" id="cb4-14" title="14">  <span class="co">// s0 * s1 + s2 * s3</span></a>
<a class="sourceLine" id="cb4-15" title="15">  <span class="kw">val</span> m1: Calc =&gt; Int = </a>
<a class="sourceLine" id="cb4-16" title="16">    calc =&gt; {</a>
<a class="sourceLine" id="cb4-17" title="17">      <span class="kw">val</span> ab = calc.<span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb4-18" title="18">      <span class="kw">val</span> cd = calc.<span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb4-19" title="19">      calc.<span class="fu">push</span>(ab)</a>
<a class="sourceLine" id="cb4-20" title="20">      calc.<span class="fu">push</span>(cd)</a>
<a class="sourceLine" id="cb4-21" title="21">      calc.<span class="fu">add</span>()</a>
<a class="sourceLine" id="cb4-22" title="22">    }</a>
<a class="sourceLine" id="cb4-23" title="23"></a>
<a class="sourceLine" id="cb4-24" title="24">  <span class="co">// x * e </span></a>
<a class="sourceLine" id="cb4-25" title="25">  <span class="kw">val</span> m2: (Calc, Int, Int) =&gt; Int =</a>
<a class="sourceLine" id="cb4-26" title="26">    (calc, x, e) =&gt; {</a>
<a class="sourceLine" id="cb4-27" title="27">      calc.<span class="fu">push</span>(x)</a>
<a class="sourceLine" id="cb4-28" title="28">      calc.<span class="fu">push</span>(e)</a>
<a class="sourceLine" id="cb4-29" title="29">      calc.<span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb4-30" title="30">    }</a>
<a class="sourceLine" id="cb4-31" title="31"></a>
<a class="sourceLine" id="cb4-32" title="32">  <span class="co">// (a * b + c * d) * e</span></a>
<a class="sourceLine" id="cb4-33" title="33">  <span class="kw">val</span> m3: (Calc, Int, Int, Int, Int, Int) =&gt; Int =</a>
<a class="sourceLine" id="cb4-34" title="34">    (calc, a, b, c, d, e) =&gt; {</a>
<a class="sourceLine" id="cb4-35" title="35">      <span class="fu">m0</span>(calc, a, b, c, d)</a>
<a class="sourceLine" id="cb4-36" title="36">      <span class="kw">val</span> r1 = <span class="fu">m1</span>(calc)</a>
<a class="sourceLine" id="cb4-37" title="37">      <span class="fu">m2</span>(calc, r1, e)</a>
<a class="sourceLine" id="cb4-38" title="38">    }</a>
<a class="sourceLine" id="cb4-39" title="39"></a>
<a class="sourceLine" id="cb4-40" title="40">}</a>
<a class="sourceLine" id="cb4-41" title="41"></a>
<a class="sourceLine" id="cb4-42" title="42">Calc.<span class="fu">m3</span>(<span class="kw">new</span> <span class="fu">Calc</span>(List[Int]()), <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="co">//&gt; 70</span></a></code></pre></div>
<p>Not too bad, but there is some annoying boilerplate, I need to repeat <code>calc.</code> every time I want to use <code>Calc</code> methods and explicitely lug state around. I would be great if I could only use method names and skip state alltogether. Let’s do some refactoring:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">object</span> Calc {</a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="kw">import</span> Calc._</a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="co">// (a, b, c, d) =&gt; (s0, s1, s2, s3)</span></a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="kw">val</span> m0: (Int, Int, Int, Int) =&gt; (Calc =&gt; Int) =</a>
<a class="sourceLine" id="cb5-6" title="6">    (a, b, c, d) =&gt;</a>
<a class="sourceLine" id="cb5-7" title="7">      calc =&gt; {</a>
<a class="sourceLine" id="cb5-8" title="8">        calc.<span class="fu">push</span>(d)</a>
<a class="sourceLine" id="cb5-9" title="9">        calc.<span class="fu">push</span>(c)</a>
<a class="sourceLine" id="cb5-10" title="10">        calc.<span class="fu">push</span>(b)</a>
<a class="sourceLine" id="cb5-11" title="11">        calc.<span class="fu">push</span>(a)</a>
<a class="sourceLine" id="cb5-12" title="12">        <span class="dv">0</span></a>
<a class="sourceLine" id="cb5-13" title="13">      }</a>
<a class="sourceLine" id="cb5-14" title="14"></a>
<a class="sourceLine" id="cb5-15" title="15">  <span class="co">// (s0 * s1 + s2 * s3)</span></a>
<a class="sourceLine" id="cb5-16" title="16">  <span class="kw">val</span> m1: () =&gt; (Calc =&gt; Int) = </a>
<a class="sourceLine" id="cb5-17" title="17">    () =&gt;</a>
<a class="sourceLine" id="cb5-18" title="18">      calc =&gt; {</a>
<a class="sourceLine" id="cb5-19" title="19">        <span class="kw">val</span> ab = calc.<span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb5-20" title="20">        <span class="kw">val</span> cd = calc.<span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb5-21" title="21">        calc.<span class="fu">push</span>(ab)</a>
<a class="sourceLine" id="cb5-22" title="22">        calc.<span class="fu">push</span>(cd)</a>
<a class="sourceLine" id="cb5-23" title="23">        calc.<span class="fu">add</span>()</a>
<a class="sourceLine" id="cb5-24" title="24">      }</a>
<a class="sourceLine" id="cb5-25" title="25"></a>
<a class="sourceLine" id="cb5-26" title="26">  <span class="co">// x * e</span></a>
<a class="sourceLine" id="cb5-27" title="27">  <span class="kw">val</span> m2: (Int, Int) =&gt; (Calc =&gt; Int) =</a>
<a class="sourceLine" id="cb5-28" title="28">    (x, e) =&gt;</a>
<a class="sourceLine" id="cb5-29" title="29">      calc =&gt; {</a>
<a class="sourceLine" id="cb5-30" title="30">        calc.<span class="fu">push</span>(x)</a>
<a class="sourceLine" id="cb5-31" title="31">        calc.<span class="fu">push</span>(e)</a>
<a class="sourceLine" id="cb5-32" title="32">        calc.<span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb5-33" title="33">      }</a>
<a class="sourceLine" id="cb5-34" title="34"></a>
<a class="sourceLine" id="cb5-35" title="35">  <span class="co">// (a * b + c * d) * e</span></a>
<a class="sourceLine" id="cb5-36" title="36">  <span class="kw">val</span> m3: (Int, Int, Int, Int, Int) =&gt; (Calc =&gt; Int) =</a>
<a class="sourceLine" id="cb5-37" title="37">    (a, b, c, d, e) =&gt;</a>
<a class="sourceLine" id="cb5-38" title="38">      calc =&gt; {</a>
<a class="sourceLine" id="cb5-39" title="39">        <span class="fu">m0</span>(a, b, c, d)(calc)</a>
<a class="sourceLine" id="cb5-40" title="40">        <span class="kw">val</span> r1 = <span class="fu">m1</span>()(calc)</a>
<a class="sourceLine" id="cb5-41" title="41">        <span class="fu">m2</span>(r1, e)(calc)</a>
<a class="sourceLine" id="cb5-42" title="42">      }</a>
<a class="sourceLine" id="cb5-43" title="43">}</a>
<a class="sourceLine" id="cb5-44" title="44"></a>
<a class="sourceLine" id="cb5-45" title="45">Calc.<span class="fu">m3</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)(<span class="kw">new</span> <span class="fu">Calc</span>(List[Int]())) <span class="co">//&gt; 70</span></a></code></pre></div>
<p>Not much better, but at least state is passed separately now, so maybe there is a chance to conceal it. The goal is to be able to write something like this:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb6-1" title="1">  <span class="kw">val</span> m3: (Int, Int, Int, Int, Int) =&gt; ??? = {</a>
<a class="sourceLine" id="cb6-2" title="2">    (a, b, c, d, e) =&gt;</a>
<a class="sourceLine" id="cb6-3" title="3">      <span class="fu">bind</span>( <span class="fu">m0</span>(a, b, c, d), { _ =&gt;</a>
<a class="sourceLine" id="cb6-4" title="4">        <span class="fu">bind</span>( <span class="fu">m1</span>(), { r1 =&gt; </a>
<a class="sourceLine" id="cb6-5" title="5">          <span class="fu">m2</span>(r1, e)</a>
<a class="sourceLine" id="cb6-6" title="6">        })</a>
<a class="sourceLine" id="cb6-7" title="7">      })</a>
<a class="sourceLine" id="cb6-8" title="8">  }</a></code></pre></div>
<p>Looking at the last refactoring it seems that <code>???</code> could be <code>Calc =&gt; Int</code>. Let’s try to define <code>bind</code> as:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb7-1" title="1">  <span class="kw">def</span> <span class="fu">bind</span>(f1: Calc =&gt; Int, f2: Int =&gt; (Calc =&gt; Int)): Calc =&gt; Int = </a>
<a class="sourceLine" id="cb7-2" title="2">    calc =&gt; {</a>
<a class="sourceLine" id="cb7-3" title="3">      <span class="kw">val</span> r1 = <span class="fu">f1</span>(calc)</a>
<a class="sourceLine" id="cb7-4" title="4">      <span class="fu">f2</span>(r1)(calc)</a>
<a class="sourceLine" id="cb7-5" title="5">    }</a></code></pre></div>
<p>Now that we defined <code>bind</code> we can write:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb8-1" title="1">  <span class="kw">val</span> m3: (Int, Int, Int, Int, Int) =&gt; (Calc =&gt; Int) = </a>
<a class="sourceLine" id="cb8-2" title="2">    (a, b, c, d, e) =&gt; {</a>
<a class="sourceLine" id="cb8-3" title="3">      <span class="fu">bind</span>(<span class="fu">m0</span>(a, b, c, d), { _ =&gt;</a>
<a class="sourceLine" id="cb8-4" title="4">        <span class="fu">bind</span>(<span class="fu">m1</span>(), { r1 =&gt; </a>
<a class="sourceLine" id="cb8-5" title="5">          <span class="fu">m2</span>(r1, e)</a>
<a class="sourceLine" id="cb8-6" title="6">        })</a>
<a class="sourceLine" id="cb8-7" title="7">      })</a>
<a class="sourceLine" id="cb8-8" title="8">    }</a></code></pre></div>
<p>Still ugly, but state is concealed at least. This notation can be improved by using Scala <code>for</code> comprehensions. Only <code>for</code> comprehensions require <code>flatMap</code> and <code>map</code> to be defined as methods of <code>Calc =&gt; Int</code>, which we can’t do. The solution is to create a wrapper:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb9-1" title="1">  <span class="kw">case</span> <span class="kw">class</span> State[S, A](runState: S =&gt; A) {</a>
<a class="sourceLine" id="cb9-2" title="2">    <span class="kw">def</span> <span class="fu">flatMap</span>(f: A =&gt; State[S, A]): State[S, A] = {</a>
<a class="sourceLine" id="cb9-3" title="3">      State(</a>
<a class="sourceLine" id="cb9-4" title="4">        s =&gt; {</a>
<a class="sourceLine" id="cb9-5" title="5">          <span class="kw">val</span> r = <span class="fu">runState</span>(s)</a>
<a class="sourceLine" id="cb9-6" title="6">          <span class="fu">f</span>(r).<span class="fu">runState</span>(s)</a>
<a class="sourceLine" id="cb9-7" title="7">        }</a>
<a class="sourceLine" id="cb9-8" title="8">      )</a>
<a class="sourceLine" id="cb9-9" title="9">    }</a>
<a class="sourceLine" id="cb9-10" title="10"></a>
<a class="sourceLine" id="cb9-11" title="11">    <span class="kw">def</span> <span class="fu">map</span>(f: A =&gt; A): State[S, A] = {</a>
<a class="sourceLine" id="cb9-12" title="12">      State(</a>
<a class="sourceLine" id="cb9-13" title="13">        s =&gt; {</a>
<a class="sourceLine" id="cb9-14" title="14">          <span class="kw">val</span> r = <span class="fu">runState</span>(s)</a>
<a class="sourceLine" id="cb9-15" title="15">          <span class="fu">f</span>(r)</a>
<a class="sourceLine" id="cb9-16" title="16">        }</a>
<a class="sourceLine" id="cb9-17" title="17">      )</a>
<a class="sourceLine" id="cb9-18" title="18">    }</a>
<a class="sourceLine" id="cb9-19" title="19">  }</a>
<a class="sourceLine" id="cb9-20" title="20"></a>
<a class="sourceLine" id="cb9-21" title="21">  <span class="kw">val</span> m3: (Int, Int, Int, Int, Int) =&gt; State[Calc, Int] = </a>
<a class="sourceLine" id="cb9-22" title="22">    (a, b, c, d, e) =&gt; {</a>
<a class="sourceLine" id="cb9-23" title="23">      State(<span class="fu">m0</span>(a, b, c, d)).<span class="fu">flatMap</span> { _ =&gt;</a>
<a class="sourceLine" id="cb9-24" title="24">        State(<span class="fu">m1</span>()).<span class="fu">flatMap</span> { r =&gt; </a>
<a class="sourceLine" id="cb9-25" title="25">          State(<span class="fu">m2</span>(r, e))</a>
<a class="sourceLine" id="cb9-26" title="26">        }</a>
<a class="sourceLine" id="cb9-27" title="27">      }</a>
<a class="sourceLine" id="cb9-28" title="28">    }</a></code></pre></div>
<p>Which can also be written as:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb10-1" title="1"></a>
<a class="sourceLine" id="cb10-2" title="2">  ...</a>
<a class="sourceLine" id="cb10-3" title="3"></a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="kw">val</span> m3: (Int, Int, Int, Int, Int) =&gt; State[Calc, Int] =</a>
<a class="sourceLine" id="cb10-5" title="5">    (a, b, c, d, e) =&gt; {</a>
<a class="sourceLine" id="cb10-6" title="6">      <span class="kw">for</span> {</a>
<a class="sourceLine" id="cb10-7" title="7">        _ &lt;-  State(<span class="fu">m0</span>(a, b, c, d))</a>
<a class="sourceLine" id="cb10-8" title="8">        r1 &lt;- State(<span class="fu">m1</span>())</a>
<a class="sourceLine" id="cb10-9" title="9">        r2 &lt;- State(<span class="fu">m2</span>(r1, e))</a>
<a class="sourceLine" id="cb10-10" title="10">      } <span class="kw">yield</span>(r2)</a>
<a class="sourceLine" id="cb10-11" title="11">    }</a></code></pre></div>
<p>This looks much better. Time to get rid of <code>State</code> here, for which we need to change <code>m0 .. m2</code> so they return a <code>State</code> object instead of <code>Calc =&gt; Int</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">object</span> Calc {</a>
<a class="sourceLine" id="cb11-2" title="2">  <span class="kw">import</span> Calc._</a>
<a class="sourceLine" id="cb11-3" title="3"></a>
<a class="sourceLine" id="cb11-4" title="4">  <span class="co">// (a, b, c, d) =&gt; (s0, s1, s2, s3)</span></a>
<a class="sourceLine" id="cb11-5" title="5">  <span class="kw">val</span> m0: (Int, Int, Int, Int) =&gt; State[Calc, Int] =</a>
<a class="sourceLine" id="cb11-6" title="6">    (a, b, c, d) =&gt;</a>
<a class="sourceLine" id="cb11-7" title="7">      State(</a>
<a class="sourceLine" id="cb11-8" title="8">        calc =&gt; {</a>
<a class="sourceLine" id="cb11-9" title="9">          calc.<span class="fu">push</span>(d)</a>
<a class="sourceLine" id="cb11-10" title="10">          calc.<span class="fu">push</span>(c)</a>
<a class="sourceLine" id="cb11-11" title="11">          calc.<span class="fu">push</span>(b)</a>
<a class="sourceLine" id="cb11-12" title="12">          calc.<span class="fu">push</span>(a)</a>
<a class="sourceLine" id="cb11-13" title="13">          <span class="dv">0</span></a>
<a class="sourceLine" id="cb11-14" title="14">        }</a>
<a class="sourceLine" id="cb11-15" title="15">      )</a>
<a class="sourceLine" id="cb11-16" title="16"></a>
<a class="sourceLine" id="cb11-17" title="17">  <span class="co">// s0 * s1 + s2 * s3</span></a>
<a class="sourceLine" id="cb11-18" title="18">  <span class="kw">val</span> m1: () =&gt; State[Calc, Int] = </a>
<a class="sourceLine" id="cb11-19" title="19">    () =&gt;</a>
<a class="sourceLine" id="cb11-20" title="20">      State(</a>
<a class="sourceLine" id="cb11-21" title="21">        calc =&gt; {</a>
<a class="sourceLine" id="cb11-22" title="22">          <span class="kw">val</span> ab = calc.<span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb11-23" title="23">          <span class="kw">val</span> cd = calc.<span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb11-24" title="24">          calc.<span class="fu">push</span>(ab)</a>
<a class="sourceLine" id="cb11-25" title="25">          calc.<span class="fu">push</span>(cd)</a>
<a class="sourceLine" id="cb11-26" title="26">          calc.<span class="fu">add</span>()</a>
<a class="sourceLine" id="cb11-27" title="27">        }</a>
<a class="sourceLine" id="cb11-28" title="28">    )</a>
<a class="sourceLine" id="cb11-29" title="29"></a>
<a class="sourceLine" id="cb11-30" title="30">  <span class="co">// e * s0</span></a>
<a class="sourceLine" id="cb11-31" title="31">  <span class="kw">val</span> m2: (Int, Int) =&gt; State[Calc, Int] =</a>
<a class="sourceLine" id="cb11-32" title="32">    (x, e) =&gt;</a>
<a class="sourceLine" id="cb11-33" title="33">      State(</a>
<a class="sourceLine" id="cb11-34" title="34">        calc =&gt; {</a>
<a class="sourceLine" id="cb11-35" title="35">          calc.<span class="fu">push</span>(x)</a>
<a class="sourceLine" id="cb11-36" title="36">          calc.<span class="fu">push</span>(e)</a>
<a class="sourceLine" id="cb11-37" title="37">          calc.<span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb11-38" title="38">        }</a>
<a class="sourceLine" id="cb11-39" title="39">      )</a>
<a class="sourceLine" id="cb11-40" title="40"></a>
<a class="sourceLine" id="cb11-41" title="41">  <span class="co">// (a * b + c * d) * e</span></a>
<a class="sourceLine" id="cb11-42" title="42">  <span class="kw">val</span> m3: (Int, Int, Int, Int, Int) =&gt; State[Calc, Int] =</a>
<a class="sourceLine" id="cb11-43" title="43">    (a, b, c, d, e) =&gt; {</a>
<a class="sourceLine" id="cb11-44" title="44">      <span class="kw">for</span> {</a>
<a class="sourceLine" id="cb11-45" title="45">        _ &lt;-  <span class="fu">m0</span>(a, b, c, d)</a>
<a class="sourceLine" id="cb11-46" title="46">        r1 &lt;- <span class="fu">m1</span>()</a>
<a class="sourceLine" id="cb11-47" title="47">        r2 &lt;- <span class="fu">m2</span>(r1, e)</a>
<a class="sourceLine" id="cb11-48" title="48">      } <span class="kw">yield</span>(r2)</a>
<a class="sourceLine" id="cb11-49" title="49">    }</a>
<a class="sourceLine" id="cb11-50" title="50">}</a>
<a class="sourceLine" id="cb11-51" title="51"></a>
<a class="sourceLine" id="cb11-52" title="52">Calc.<span class="fu">m3</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>).<span class="fu">runState</span>(<span class="kw">new</span> <span class="fu">Calc</span>(List[Int]())) <span class="co">//&gt; 70</span></a></code></pre></div>
<p>At this point it’s easy to notice that we drag mutable state around and there is no particular reason why it should be mutable, we can always update state and pass a new state forward. Also methods <code>push</code>, <code>pop</code>, <code>add</code>, <code>mul</code> don’t look special anymore, they are not that different from <code>m0</code>, <code>m1</code>, <code>m2</code>, <code>m3</code>. So let’s create an improved version of class <code>State</code> and also implement those 4 methods. We can completely abandon the class <code>Calc</code> then since there is nothing left there except for <code>List[Int]</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">object</span> Calc {</a>
<a class="sourceLine" id="cb12-2" title="2"></a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="kw">case</span> <span class="kw">class</span> State[S, A](runState: S =&gt; (A, S)) {</a>
<a class="sourceLine" id="cb12-4" title="4">    <span class="kw">def</span> flatMap[B](f: A =&gt; State[S, B]): State[S, B] = {</a>
<a class="sourceLine" id="cb12-5" title="5">      State(</a>
<a class="sourceLine" id="cb12-6" title="6">        s =&gt; {</a>
<a class="sourceLine" id="cb12-7" title="7">          <span class="kw">val</span> (r, newState) = <span class="fu">runState</span>(s)</a>
<a class="sourceLine" id="cb12-8" title="8">          <span class="fu">f</span>(r).<span class="fu">runState</span>(newState)</a>
<a class="sourceLine" id="cb12-9" title="9">        }</a>
<a class="sourceLine" id="cb12-10" title="10">      )</a>
<a class="sourceLine" id="cb12-11" title="11">    }</a>
<a class="sourceLine" id="cb12-12" title="12"></a>
<a class="sourceLine" id="cb12-13" title="13">    <span class="kw">def</span> map[B](f: A =&gt; B): State[S, B] =</a>
<a class="sourceLine" id="cb12-14" title="14">      flatMap { x =&gt; State.<span class="fu">unit</span>(<span class="fu">f</span>(x)) }</a>
<a class="sourceLine" id="cb12-15" title="15"></a>
<a class="sourceLine" id="cb12-16" title="16">    <span class="kw">def</span> <span class="fu">getResult</span>(s: S) = <span class="fu">runState</span>(s)._<span class="dv">1</span></a>
<a class="sourceLine" id="cb12-17" title="17">  }</a>
<a class="sourceLine" id="cb12-18" title="18"></a>
<a class="sourceLine" id="cb12-19" title="19">  <span class="kw">object</span> State {</a>
<a class="sourceLine" id="cb12-20" title="20">    <span class="kw">def</span> <span class="dt">unit</span>[S, A](x: A): State[S, A] =</a>
<a class="sourceLine" id="cb12-21" title="21">      State((x, _))</a>
<a class="sourceLine" id="cb12-22" title="22">  }</a>
<a class="sourceLine" id="cb12-23" title="23"></a>
<a class="sourceLine" id="cb12-24" title="24">  <span class="kw">val</span> push: Int =&gt; State[List[Int], Unit] = </a>
<a class="sourceLine" id="cb12-25" title="25">    x =&gt; State(s =&gt; ((), x::s))</a>
<a class="sourceLine" id="cb12-26" title="26"></a>
<a class="sourceLine" id="cb12-27" title="27">  <span class="kw">val</span> pop: () =&gt; State[List[Int], Int] =</a>
<a class="sourceLine" id="cb12-28" title="28">    () =&gt; State { <span class="kw">case</span> (x::xs) =&gt; (x, xs) }</a>
<a class="sourceLine" id="cb12-29" title="29"></a>
<a class="sourceLine" id="cb12-30" title="30">  <span class="kw">val</span> add: () =&gt; State[List[Int], Int] = </a>
<a class="sourceLine" id="cb12-31" title="31">    () =&gt; State { <span class="kw">case</span> (a::b::xs) =&gt; (a + b, xs) }</a>
<a class="sourceLine" id="cb12-32" title="32"></a>
<a class="sourceLine" id="cb12-33" title="33">  <span class="kw">val</span> mul: () =&gt; State[List[Int], Int] = </a>
<a class="sourceLine" id="cb12-34" title="34">    () =&gt; State { <span class="kw">case</span> (a::b::xs) =&gt; (a * b, xs) }</a>
<a class="sourceLine" id="cb12-35" title="35"></a>
<a class="sourceLine" id="cb12-36" title="36">  <span class="co">// (a, b, c, d) =&gt; (s0, s1, s2, s3)</span></a>
<a class="sourceLine" id="cb12-37" title="37">  <span class="kw">val</span> m0: (Int, Int, Int, Int) =&gt; State[List[Int], Unit] =</a>
<a class="sourceLine" id="cb12-38" title="38">    (a, b, c, d) =&gt;</a>
<a class="sourceLine" id="cb12-39" title="39">      <span class="kw">for</span> {</a>
<a class="sourceLine" id="cb12-40" title="40">        _ &lt;- <span class="fu">push</span>(d)</a>
<a class="sourceLine" id="cb12-41" title="41">        _ &lt;- <span class="fu">push</span>(c)</a>
<a class="sourceLine" id="cb12-42" title="42">        _ &lt;- <span class="fu">push</span>(b)</a>
<a class="sourceLine" id="cb12-43" title="43">        _ &lt;- <span class="fu">push</span>(a)</a>
<a class="sourceLine" id="cb12-44" title="44">      } <span class="kw">yield</span>(())</a>
<a class="sourceLine" id="cb12-45" title="45"></a>
<a class="sourceLine" id="cb12-46" title="46">  <span class="co">// s0 * s1 + s2 * s3</span></a>
<a class="sourceLine" id="cb12-47" title="47">  <span class="kw">val</span> m1: () =&gt; State[List[Int], Int] =</a>
<a class="sourceLine" id="cb12-48" title="48">    () =&gt;</a>
<a class="sourceLine" id="cb12-49" title="49">      <span class="kw">for</span> {</a>
<a class="sourceLine" id="cb12-50" title="50">        ab &lt;- <span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb12-51" title="51">        cd &lt;- <span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb12-52" title="52">        _ &lt;- <span class="fu">push</span>(ab)</a>
<a class="sourceLine" id="cb12-53" title="53">        _ &lt;- <span class="fu">push</span>(cd)</a>
<a class="sourceLine" id="cb12-54" title="54">        s &lt;- <span class="fu">add</span>()</a>
<a class="sourceLine" id="cb12-55" title="55">      } <span class="kw">yield</span>(s)</a>
<a class="sourceLine" id="cb12-56" title="56"></a>
<a class="sourceLine" id="cb12-57" title="57">  <span class="co">// e * s0</span></a>
<a class="sourceLine" id="cb12-58" title="58">  <span class="kw">val</span> m2: (Int, Int) =&gt; State[List[Int], Int] =</a>
<a class="sourceLine" id="cb12-59" title="59">    (x, e) =&gt;</a>
<a class="sourceLine" id="cb12-60" title="60">      <span class="kw">for</span> {</a>
<a class="sourceLine" id="cb12-61" title="61">        _ &lt;- <span class="fu">push</span>(x)</a>
<a class="sourceLine" id="cb12-62" title="62">        _ &lt;- <span class="fu">push</span>(e)</a>
<a class="sourceLine" id="cb12-63" title="63">        p &lt;- <span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb12-64" title="64">      } <span class="kw">yield</span>(p)</a>
<a class="sourceLine" id="cb12-65" title="65"></a>
<a class="sourceLine" id="cb12-66" title="66">  <span class="co">// (a * b + c * d) * e</span></a>
<a class="sourceLine" id="cb12-67" title="67">  <span class="kw">val</span> m3: (Int, Int, Int, Int, Int) =&gt; State[List[Int], Int] =</a>
<a class="sourceLine" id="cb12-68" title="68">    (a, b, c, d, e) =&gt; {</a>
<a class="sourceLine" id="cb12-69" title="69">      <span class="kw">for</span> {</a>
<a class="sourceLine" id="cb12-70" title="70">        _ &lt;-  <span class="fu">m0</span>(a, b, c, d)</a>
<a class="sourceLine" id="cb12-71" title="71">        r1 &lt;- <span class="fu">m1</span>()</a>
<a class="sourceLine" id="cb12-72" title="72">        r2 &lt;- <span class="fu">m2</span>(r1, e)</a>
<a class="sourceLine" id="cb12-73" title="73">      } <span class="kw">yield</span>(r2)</a>
<a class="sourceLine" id="cb12-74" title="74">    }</a>
<a class="sourceLine" id="cb12-75" title="75">}</a>
<a class="sourceLine" id="cb12-76" title="76"></a>
<a class="sourceLine" id="cb12-77" title="77">Calc.<span class="fu">m3</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>).<span class="fu">getResult</span>(Nil) <span class="co">//&gt; 70</span></a></code></pre></div>
<p>Class <code>State[S, A]</code> is called State monad in functional programming. Let’s look at the benefits:</p>
<ol type="1">
<li><p>New methods are easily composable, good for code reuse.</p></li>
<li><p>We started from an attempt to get rid of a boilerplate:</p></li>
</ol>
<div class="sourceCode" id="cb13"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb13-1" title="1"><span class="co">// Before</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">val</span> m1: () =&gt; (Calc =&gt; Int) = </a>
<a class="sourceLine" id="cb13-3" title="3">  () =&gt;</a>
<a class="sourceLine" id="cb13-4" title="4">    calc =&gt; {</a>
<a class="sourceLine" id="cb13-5" title="5">      <span class="kw">val</span> ab = calc.<span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb13-6" title="6">      <span class="kw">val</span> cd = calc.<span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb13-7" title="7">      calc.<span class="fu">push</span>(ab)</a>
<a class="sourceLine" id="cb13-8" title="8">      calc.<span class="fu">push</span>(cd)</a>
<a class="sourceLine" id="cb13-9" title="9">      calc.<span class="fu">add</span>()</a>
<a class="sourceLine" id="cb13-10" title="10">    }</a>
<a class="sourceLine" id="cb13-11" title="11"></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="co">// After</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="kw">val</span> m1: () =&gt; State[List[Int], Int] =</a>
<a class="sourceLine" id="cb13-14" title="14">  () =&gt;</a>
<a class="sourceLine" id="cb13-15" title="15">    <span class="kw">for</span> {</a>
<a class="sourceLine" id="cb13-16" title="16">      ab &lt;- <span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb13-17" title="17">      cd &lt;- <span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb13-18" title="18">      _ &lt;- <span class="fu">push</span>(ab)</a>
<a class="sourceLine" id="cb13-19" title="19">      _ &lt;- <span class="fu">push</span>(cd)</a>
<a class="sourceLine" id="cb13-20" title="20">      s &lt;- <span class="fu">add</span>()</a>
<a class="sourceLine" id="cb13-21" title="21">    } <span class="kw">yield</span>(s)</a></code></pre></div>
<p>I would argue the latter is more readable and less error prone, repeating <code>calc.</code> in the former snippet simply creates a visual noise. So State monad provides a good way to build DSL-like composition.</p>
<ol start="3" type="1">
<li>Immutable state. Not sure it brings much here since state is concealed and harder to mess up with.</li>
</ol>
<p>We can easily apply other monadic concepts here, e.g. <code>traverse</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb14-1" title="1">  <span class="kw">object</span> State {</a>
<a class="sourceLine" id="cb14-2" title="2">    ...</a>
<a class="sourceLine" id="cb14-3" title="3"></a>
<a class="sourceLine" id="cb14-4" title="4">    <span class="kw">def</span> traverse[S, A, B](la: List[A])(f: A =&gt; State[S, B]): State[S, List[B]] =</a>
<a class="sourceLine" id="cb14-5" title="5">      State(</a>
<a class="sourceLine" id="cb14-6" title="6">        s =&gt; {</a>
<a class="sourceLine" id="cb14-7" title="7">          <span class="kw">val</span> (bs, newS) =</a>
<a class="sourceLine" id="cb14-8" title="8">            la.<span class="fu">foldLeft</span>((collection.<span class="fu">mutable</span>.<span class="fu">ListBuffer</span>[B](), s)) { <span class="kw">case</span> ((bs, s), a) =&gt; </a>
<a class="sourceLine" id="cb14-9" title="9">              <span class="kw">val</span> (r, newS) = <span class="fu">f</span>(a).<span class="fu">runState</span>(s)</a>
<a class="sourceLine" id="cb14-10" title="10">              (bs :+ r, newS)</a>
<a class="sourceLine" id="cb14-11" title="11">            }</a>
<a class="sourceLine" id="cb14-12" title="12">          (bs.<span class="fu">toList</span>, newS)</a>
<a class="sourceLine" id="cb14-13" title="13">        }</a>
<a class="sourceLine" id="cb14-14" title="14">      )</a>
<a class="sourceLine" id="cb14-15" title="15">  }</a></code></pre></div>
<p>With <code>traverse</code> code becomes even shorter:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode scala"><code class="sourceCode scala"><a class="sourceLine" id="cb15-1" title="1">  <span class="co">// Before</span></a>
<a class="sourceLine" id="cb15-2" title="2"></a>
<a class="sourceLine" id="cb15-3" title="3">  <span class="kw">val</span> push: Int =&gt; State[List[Int], Unit] = </a>
<a class="sourceLine" id="cb15-4" title="4">    x =&gt; State(s =&gt; ((), x::s))</a>
<a class="sourceLine" id="cb15-5" title="5"></a>
<a class="sourceLine" id="cb15-6" title="6">  <span class="kw">val</span> m0: (Int, Int, Int, Int) =&gt; State[List[Int], Unit] =</a>
<a class="sourceLine" id="cb15-7" title="7">    (a, b, c, d) =&gt;</a>
<a class="sourceLine" id="cb15-8" title="8">      <span class="kw">for</span> {</a>
<a class="sourceLine" id="cb15-9" title="9">        _ &lt;- <span class="fu">push</span>(d)</a>
<a class="sourceLine" id="cb15-10" title="10">        _ &lt;- <span class="fu">push</span>(c)</a>
<a class="sourceLine" id="cb15-11" title="11">        _ &lt;- <span class="fu">push</span>(b)</a>
<a class="sourceLine" id="cb15-12" title="12">        _ &lt;- <span class="fu">push</span>(a)</a>
<a class="sourceLine" id="cb15-13" title="13">      } <span class="kw">yield</span>(())</a>
<a class="sourceLine" id="cb15-14" title="14"></a>
<a class="sourceLine" id="cb15-15" title="15">  <span class="co">// s0 * s1 + s2 * s3</span></a>
<a class="sourceLine" id="cb15-16" title="16">  <span class="kw">val</span> m1: () =&gt; State[List[Int], Int] =</a>
<a class="sourceLine" id="cb15-17" title="17">    () =&gt;</a>
<a class="sourceLine" id="cb15-18" title="18">      <span class="kw">for</span> {</a>
<a class="sourceLine" id="cb15-19" title="19">        ab &lt;- <span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb15-20" title="20">        cd &lt;- <span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb15-21" title="21">        _ &lt;- <span class="fu">push</span>(ab)</a>
<a class="sourceLine" id="cb15-22" title="22">        _ &lt;- <span class="fu">push</span>(cd)</a>
<a class="sourceLine" id="cb15-23" title="23">        s &lt;- <span class="fu">add</span>()</a>
<a class="sourceLine" id="cb15-24" title="24">      } <span class="kw">yield</span>(s)</a>
<a class="sourceLine" id="cb15-25" title="25"></a>
<a class="sourceLine" id="cb15-26" title="26">  ...</a>
<a class="sourceLine" id="cb15-27" title="27"></a>
<a class="sourceLine" id="cb15-28" title="28"></a>
<a class="sourceLine" id="cb15-29" title="29">  <span class="co">// After</span></a>
<a class="sourceLine" id="cb15-30" title="30">  <span class="kw">val</span> push: (Int*) =&gt; State[List[Int], List[Unit]] = </a>
<a class="sourceLine" id="cb15-31" title="31">    (xs) =&gt;</a>
<a class="sourceLine" id="cb15-32" title="32">      State.<span class="fu">traverse</span>(xs.<span class="fu">toList</span>)(x =&gt; State(s =&gt; ((), x::s)))</a>
<a class="sourceLine" id="cb15-33" title="33"></a>
<a class="sourceLine" id="cb15-34" title="34">  <span class="co">// s0 * s1 + s2 * s3</span></a>
<a class="sourceLine" id="cb15-35" title="35">  <span class="kw">val</span> m1: () =&gt; State[List[Int], Int] =</a>
<a class="sourceLine" id="cb15-36" title="36">    () =&gt;</a>
<a class="sourceLine" id="cb15-37" title="37">      <span class="kw">for</span> {</a>
<a class="sourceLine" id="cb15-38" title="38">        ab &lt;- <span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb15-39" title="39">        cd &lt;- <span class="fu">mul</span>()</a>
<a class="sourceLine" id="cb15-40" title="40">        _ &lt;- <span class="fu">push</span>(ab, cd)</a>
<a class="sourceLine" id="cb15-41" title="41">        s &lt;- <span class="fu">add</span>()</a>
<a class="sourceLine" id="cb15-42" title="42">      } <span class="kw">yield</span>(s)</a></code></pre></div>

        </div>

        
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'blog-vmoroz-com';
                var disqus_identifier = '0f8039cc-dcfd-4a93-ac15-f4d25db6da4a';
                
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
        

        <div id="footer">
            Generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
